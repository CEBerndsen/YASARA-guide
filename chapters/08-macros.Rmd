# Macros

Throughout this guide, the command line using syntax such as `ColorRes` and `PosOriObj` has been useful for doing manipulations to the structures and scenes in YASARA. However, typing many commands repeatedly can be tedious and potentially irreproducible. Static images are great illustrations of simple points, however sometimes an idea is too complex or a single image OR an interactive movie might be a more useful display item. This is where macros can come in. A **macro** is a file that contains all the commands as you would type them into the command line that is read by YASARA as a series of instructions for how to show, analyze, and/or record data. This chapter will focus on macros for making movies such as those shown HERE, while Chapter 9 will focus on macros for analysis.

## Text editors

Making a macro for YASARA requires a text editor such as [NotePad](https://en.wikipedia.org/wiki/Microsoft_Notepad), [WordPad](https://en.wikipedia.org/wiki/WordPad), or [TextEdit](https://support.apple.com/guide/textedit/welcome/mac). Each command is listed on a separate line and the entire file saved as a .mcr file type.  See \@ref(macrosave) and \@ref(macrotext) for more information about saving YASARA appropriate macro files. 

## Organization of a macro {#macro}

Macros, regardless of function, all share a common header like that shown in Figure \@ref(fig:header). The header is not shown or seen, unless the macro file is opened directly, but it can provide useful information to the reader such as the purpose and author of the macro.

```{r header, echo=FALSE, warning=FALSE, message=FALSE, out.width="120%", fig.cap="Macro header in YASARA"}

knitr::include_graphics("images/mcrheader.PNG")

```

### The `#` as a way to help your reader (and you!)

A list of YASARA commands, such as is shown below, can be dense to read and interpret.

```{r dense, echo=TRUE, warning=FALSE, message=FALSE, eval=FALSE}
>LoadPDB 1crn, download=yes
>AutoPosOriObj 1, x = 1, y = 10, z = 0, alpha = 0, beta = 0, gamma = 0
>ColorRes cys, green
>ShowRes cys
>BallStickRes cys
>AutoRotateObj 1, Y = 1
>wait 180
>AutoRotateObj 1, Y = 0
>ZoomRes Cys 16, step = 50
>wait 100
>ZoomRes all

```

Just reading this list of commands and finding the one you need is difficult. Any line that starts with `#` however will not be read by YASARA and can serve to help reduce the density of text and is good for writing notes to your future self as shown below.

```{r sparse, echo=TRUE, warning=FALSE, message=FALSE, eval=FALSE}
# Load the structure of crambin from the internet
>LoadPDB 1crn, download=yes

# Position and orient the object as below to better show the over structure
>AutoPosOriObj 1, x = 1, y = 10, z = 0, alpha = 0, beta = 0, gamma = 0

#Color the cysteine residues green and show them as ball-stick forms
>ColorRes cys, green
>ShowRes cys
>BallStickRes cys

# Rotate the object, wait for 180 degrees, then stop
>AutoRotateObj 1, Y = 1
>wait 180
>AutoRotateObj 1, Y = 0

# Zoom in on cysteine 16 over the course of 50 steps, wait for 100 screen refreshes, then zoom out
>ZoomRes Cys 16, step = 50
>wait 100
>ZoomRes all, step = 50

```

Reading the annotated commands above, it is clearer what is intended and how the code leads to this result. Use `#` as a note to your future self so that if you need to re-use code or want to troubleshoot, you can find your target easier.

## Making a macro {#macrotext}

To make a macro, open your text editor then make your header followed by your commands. HERE is a general template that can be derived as needed. The first set of commands are shown in the code box below and they set the environment. These settings can be adjusted as needed (use `SearchDoc` for more details) but are good places to start for most computers.

```{r macrot, echo=TRUE, warning=FALSE, message=FALSE, eval=FALSE}

# Change working directory to the place of this macro
# (so that we don't have to specify paths when loading stuff).
CD (MacroDir)

#If there is an error, the macro continues
OnError Continue

# Don't show console and head up display
Console Off
HUD Off

# Set default parameters
CoordSys Left
Projection perspective
StickRadius 50
BallStickRadius 50,50
AtomTexture 1
Fog 70
ColorFog Black
SurfPar Resolution=3, Molecular=Gaussian
AtomSize 100

# Animation delay
delay=400

# Set the YASARA window size
ScreenSize X=1024,Y=768,Scale=1

```

### Commands that can be used in a macro

After the header and the environment settings, the YASARA commands can then be typed with one command per line. For most macros that are simply displaying structures, the commands like `Color` (\@ref(colors)), `PosOri` (\@ref(orient)), and `Label` (\@ref(labels)) along with broader sets of commands for changing display style (\@ref(style)) and surfaces (\@ref(surfaces)) work just as they would be typed into the command line. However there are additional commands that can be useful as well. 

#### Rotate {#rotate}

The `Rotate` command is similar to the `PosOri` commands described in section \@ref(orient). In `Rotate`, the Obj is specified along with the axis of rotation (X, Y or Z) and the number of degrees as shown below.

```{r rotate, echo=TRUE, eval=FALSE}
# Load the structure of crambin from the internet
>LoadPDB 1crn, download=yes

# Rotate  Obj 1 30 degrees around the Y-axis
>RotateObj 1, Y = 30

# Rotate the Obj 1 30 degrees around the Y-axis and 20 degrees around the Z-axis
>RotateObj 1, Y = 30, Z = 20


```

For macros that are being used to display information in a presentation style, it is worth using `AutoRotate`, which animates the rotation in a nice format. The command is the same, except `Auto` needs to be inserted before `Rotate` as shown below. One caution is that `AutoRotate` needs a stop command in the form of the same command with the axis rotations set to 0.

```{r autorotate, echo=TRUE, eval=FALSE}
# Load the structure of crambin from the internet
>LoadPDB 1crn, download=yes

# Rotate  Obj 1 around the Y-axis in 1 degree steps
>AutoRotateObj 1, Y = 1

# Rotate the Obj 1 the Y-axis and the Z-axis in 1 degree steps
>AutoRotateObj 1, Y = 1, Z = 1

# To stop rotate set the axis to zero
>AutoRotateObj 1, Y = 0, Z = 0

```

**Stylistic suggestion:** Do not set the `AutoRotate` command to move more than 2 degrees per step as it can get disorienting with fast spinning.

#### Displaying images

Images can also be added to a macro and positioned within the viewing window, however it is a two step process. 

  1. **Load** the image file into the program using the commands `LoadPNG` and `LoadJPG` depending on your file type
  
  2. **Show** the image using the command `ShowImage` followed by a number. If you have only loaded 1 image, this value is likely 1.
  
`ShowImage` also takes commands to position and size the image within the viewing window as detailed below and shown in the code chunk with the results shown in Figure \@ref(fig:images).


  - **X and Y :** These set the coordinates for the top left corner of the image. These can be negative if you want the image to be moved down and right.
  
  - ** Width and Height:** Sets the width and height of the image. If they are larger than the image itself, then the image will be reduced on the screen.
  
  - **Alpha:** Like surfaces, you can adjust the transparency of an image. 100 is non-transparent, while 0 is completely transparent.
  
  - **Priority:** This is the layering function of the command. If set to 1, then the images is on top, if set to 0, then it is on the bottom and any structures will appear over the image.
  
```{r showimage, eval=FALSE, echo=TRUE}
# Load the image called slide_1 into the memory
>LoadJPG example

# Show the image at full size
>ShowImage 1

# Show the image, but at a different position
>ShowImage 1, X = -1100, Y = -500, Alpha=100, Priority=1

# Show the image, but at a different position and scaling
>ShowImage 1, X = -100, Y = -500, Width = 5000, Height = 5000, Alpha=100, Priority=1

# Show the image underneath of DNA
>LoadPDB 1BNA, download=yes
>ShowImage 1, Priority=0

```


```{r images, echo=FALSE, warning=FALSE, message=FALSE, out.width="100%", fig.cap="Results from Load and ShowImage commands"}
#Load images
ubone <- image_read("../images/example1.PNG")
ubtwo <- image_read("../images/example2.PNG")
ubthree <- image_read("../images/example3.PNG")
ubfour <- image_read("../images/example4.PNG")

ubone <- ggdraw() + draw_image(ubone)
ubtwo <- ggdraw() + draw_image(ubtwo)
ubthree <- ggdraw() + draw_image(ubthree)
ubfour <- ggdraw() + draw_image(ubfour)

plot_grid(ubone, ubtwo, ubthree, ubfour, labels = "AUTO")

```

##### Hiding or removing images

When an image is no longer needed, it is prudent to hide the image on the screen or delete the image from the memory. To hide the image, the command is `HideImage` followed by the image number. To delete the image, the command is `DelImage` followed by the image number. Hide is preferred if the image will be needed again, such as a background image. 

#### Showing messages



#### Wait

#### Click buttons

### Saving the macro {#macrosave}

### Playing the macro {#macroplay}

#### Drag and Drop

## Macro examples

## Knowledge Checks^[Answers can be found \@ref(sevenkey)]


